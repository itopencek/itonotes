<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>itoNotes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="style/index.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
    
    <!-- Quill -->
    <script src="//cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="//cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">
    <!-- end of Quill -->

    <link href='style.css' rel='stylesheet'>

</head>
<body>
    <header>
        
    </header>
    <main>
        <section id='editor-wrapper'>
            <div id='editor'>
            </div>
        </section>
    </main>
    <footer>

    </footer>
    <script>
        var Delta = Quill.import('delta');
        var quill = new Quill('#editor', {
  modules: {
    toolbar: [
      [ { size: [ 'small', false, 'large', 'huge' ] } ],
      ['bold', 'italic', 'underline', 'strike'],
      [{'color' : [] },{'background' : [] }],
      ['link']
    ]
  },
  placeholder: 'Note everything...',
  theme: 'snow'  // or 'bubble'
});

var change = new Delta();
quill.on('text-change', (delta) => {
  change = change.compose(delta);
});

setInterval(() => {
  if (change.length() > 0) {
    console.log('Saving changes ', change);

   /*
    insert here the ajax logic
   */
   let data = quill.getContents();
   $.ajax({
     type: 'GET',
     dataType: 'json',
     data: data,
     url: '/request'
   })
   .done((res)=>{
     console.log(res);
   })
    
    change = new Delta();
  }
}, 3000);

window.onbeforeunload = () => {
  if (change.length() > 0) {
    return 'There are unsaved changes. Are you sure you want to leave?';
  }
}

    </script>
</body>
</html>